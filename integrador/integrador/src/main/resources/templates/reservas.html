<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Sistema de Reservas</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Montagu+Slab:opsz,wght@16..144,100..700&display=swap" rel="stylesheet">

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <!-- Tus estilos CSS -->
    <link rel="stylesheet" th:href="@{/styles/index.css}">
    <link rel="stylesheet" th:href="@{/styles/styles-reservas.css}">
    <link rel="stylesheet" th:href="@{/styles/navbar-footer.css}">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    
</head>
<body>
    <!--Header-->
<div class="container-fluid d-flex justify-content-center align-items-center flex-column p-0" id="container-principal">
    <div th:replace="fragments/header :: header"></div>
</div>
<!--Fin Header-->
    <section id="step1" class="step">
        <div class="steps">
            <span class="active">1</span>
            <span>2</span>
            <span>3</span>
        </div>
        <h2>Detalles de la Reserva</h2>
        <form id="step1-form">
            <label for="personas">Número de Personas:</label>
            <input type="number" id="personas" name="personas" required min="1" max="10">
            
            <label for="fecha">Fecha:</label>
            <input type="date" id="fecha" name="fecha" required>
            
            <label for="hora">Hora:</label>
            <input type="time" id="hora" name="hora" required>
            
            <button type="submit">Siguiente</button>
        </form>
    </section>

    <section id="step2" class="step hidden">
        <div class="steps">
            <span>1</span>
            <span class="active">2</span>
            <span>3</span>
        </div>
        <h2>Información Personal</h2>
        <form id="step2-form">
            <label for="nombre">Nombre:</label>
            <input type="text" id="nombre" name="nombre" required>
            
            <label for="apellido">Apellido:</label>
            <input type="text" id="apellido" name="apellido" required>
            
            <label for="email">Email:</label>
            <input type="email" id="email" name="email" required>
            
            <label for="telefono">Teléfono:</label>
            <input type="tel" id="telefono" name="telefono" required>
            
            <button type="button" class="volver" data-step="1">Volver</button>
            <button type="submit">Siguiente</button>
        </form>
    </section>

    <section id="step3" class="step hidden">
        <div class="steps">
            <span>1</span>
            <span>2</span>
            <span class="active">3</span>
        </div>
        <h2>Preferencias</h2>
        <form id="step3-form" th:action="@{/reservas/guardar}" method="post">
            <label for="mesa">Preferencia de Mesa:</label>
            <select id="mesa" name="mesa" required>
                <option value="">Seleccione una opción</option>
                <option value="Interior">Interior</option>
                <option value="Exterior">Exterior</option>
                <option value="Ventana">Junto a la Ventana</option>
            </select>
            
            <label>¿Tiene alergias?</label>
            <div>
                <input type="radio" id="alergias-si" name="alergias" value="Sí" required>
                <label for="alergias-si">Sí</label>
                <input type="radio" id="alergias-no" name="alergias" value="No">
                <label for="alergias-no">No</label>
            </div>
            
            <label for="comentario">Comentarios adicionales:</label>
            <textarea id="comentario" name="comentario" rows="4"></textarea>
            
            <button type="button" class="volver" data-step="2">Volver</button>
            <button type="submit">Confirmar Reserva</button>
        </form>
    </section>

    <section id="step4" class="step hidden">
        <h2>¡Reserva Confirmada!</h2>
        <div class="details">
            <p>Número de Personas: <span id="reserva-personas"></span></p>
            <p>Fecha: <span id="reserva-fecha"></span></p>
            <p>Hora: <span id="reserva-hora"></span></p>
            <p>Nombre: <span id="reserva-nombre"></span></p>
            <p>Mesa: <span id="reserva-mesa"></span></p>
            <p>Alergias: <span id="reserva-alergias"></span></p>
        </div>
        <button onclick="volverAlInicio()">Realizar otra reserva</button>
    </section>

    <script th:inline="javascript">
        document.addEventListener("DOMContentLoaded", function() {
            const { jsPDF } = window.jspdf;

            function goToStep(step) {
                document.querySelectorAll("section").forEach(function(section) {
                    section.classList.add("hidden");
                });
                document.getElementById("step" + step).classList.remove("hidden");
            }

            function validateStep1() {
                const personas = document.getElementById("personas").value;
                const fecha = document.getElementById("fecha").value;
                const hora = document.getElementById("hora").value;
                return personas && fecha && hora;
            }

            function validateStep2() {
                const nombre = document.getElementById("nombre").value;
                const apellido = document.getElementById("apellido").value;
                const email = document.getElementById("email").value;
                const telefono = document.getElementById("telefono").value;
                return nombre && apellido && email && telefono;
            }

            function validateStep3() {
                const mesa = document.getElementById("mesa").value;
                const alergias = document.querySelector('input[name="alergias"]:checked');
                return mesa && alergias;
            }

            function generarPDF(formData) {
                const doc = new jsPDF();
                
                doc.setFont("helvetica");
                doc.setFontSize(20);
                doc.text("Confirmación de Reserva", 105, 20, { align: "center" });
                
                doc.setFontSize(12);
                const detalles = [
                    `Número de Personas: ${formData.personas}`,
                    `Fecha: ${formData.fecha}`,
                    `Hora: ${formData.hora}`,
                    `Nombre: ${formData.nombre} ${formData.apellido}`,
                    `Email: ${formData.email}`,
                    `Teléfono: ${formData.telefono}`,
                    `Mesa Preferida: ${formData.mesa}`,
                    `Alergias: ${formData.alergias}`,
                    `Comentarios: ${formData.comentario || 'Ninguno'}`
                ];

                let y = 40;
                detalles.forEach(detalle => {
                    doc.text(detalle, 20, y);
                    y += 10;
                });

                doc.save('confirmacion-reserva.pdf');
            }

            // Event Listeners
            document.getElementById("step1-form").addEventListener("submit", function(e) {
                e.preventDefault();
                if (validateStep1()) goToStep(2);
                else alert("Por favor, complete todos los campos");
            });

            document.getElementById("step2-form").addEventListener("submit", function(e) {
                e.preventDefault();
                if (validateStep2()) goToStep(3);
                else alert("Por favor, complete todos los campos");
            });

            document.getElementById("step3-form").addEventListener("submit", function(e) {
                e.preventDefault();
                if (validateStep3()) {
                    const formData = {
                        personas: document.getElementById("personas").value,
                        fecha: document.getElementById("fecha").value,
                        hora: document.getElementById("hora").value,
                        nombre: document.getElementById("nombre").value,
                        apellido: document.getElementById("apellido").value,
                        email: document.getElementById("email").value,
                        telefono: document.getElementById("telefono").value,
                        mesa: document.getElementById("mesa").value,
                        alergias: document.querySelector('input[name="alergias"]:checked').value,
                        comentario: document.getElementById("comentario").value
                    };

                    // Actualizar vista de confirmación
                    document.getElementById("reserva-personas").textContent = formData.personas;
                    document.getElementById("reserva-fecha").textContent = formData.fecha;
                    document.getElementById("reserva-hora").textContent = formData.hora;
                    document.getElementById("reserva-nombre").textContent = formData.nombre;
                    document.getElementById("reserva-mesa").textContent = formData.mesa;
                    document.getElementById("reserva-alergias").textContent = formData.alergias;

                    // Generar PDF y mostrar confirmación
                    generarPDF(formData);
                    goToStep(4);
                } else {
                    alert("Por favor, complete todos los campos");
                }
            });

            document.querySelectorAll(".volver").forEach(function(button) {
                button.addEventListener("click", function() {
                    goToStep(this.getAttribute("data-step"));
                });
            });
        });

        function volverAlInicio() {
            location.reload();
        }
    </script>
    <!--Footer-->
<div th:replace="fragments/footer :: footer"></div>
<!--Fin Footer-->
</body>
</html>